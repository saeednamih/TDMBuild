<fieldset class="animated fadeInRightBig">
    <h2>{{"REQUESTED_ENTITIES" | translate}}</h2>
    <div class="row">
        <div class="form-group col-lg-12">
            <div class="col-lg-4" style="padding-left: 0">
                <div ng-if="!taskCtrl.taskData.selectAllEntites" class="form-group i-checks col-lg-12">
                    <label>
                        <input ng-disabled="taskCtrl.disableChange"  type="radio" ng-value="'given'"
                               name="connectionRadio" ng-model="taskCtrl.selectFieldType"> {{"ENTITIES_LIST" |
                        translate}}
                    </label>
                </div>
                <div ng-if="taskCtrl.taskData.task_type == 'LOAD' && !taskCtrl.taskData.version_ind && !taskCtrl.adi_only"
                     class="form-group i-checks col-lg-12"
                     style="{{taskCtrl.userRole.allowed_random_entity_selection == false ? 'padding-left : 25px' : ''}}">
                    <label>
                        <input ng-disabled="taskCtrl.disableChange"
                               ng-if="taskCtrl.userRole.allowed_random_entity_selection == true"  type="radio"
                               ng-value="'random'" name="connectionRadio" ng-model="taskCtrl.selectFieldType">
                        {{"RANDOM_SELECTION" | translate}}
                        <small ng-show="!taskCtrl.userRole.allowed_random_entity_selection">(Not Allowed)</small>
                    </label>
                </div>
                <div ng-if="taskCtrl.taskData.task_type == 'LOAD' && !taskCtrl.taskData.version_ind"
                     class="form-group i-checks col-lg-12">
                    <label style="{{taskCtrl.userRole.allowed_creation_of_synthetic_data == false ? 'padding-left : 25px' : ''}}">
                        <input ng-disabled="taskCtrl.disableChange"
                               ng-if="taskCtrl.userRole.allowed_creation_of_synthetic_data == true"  type="radio"
                               ng-value="'synthetic'" name="connectionRadio" ng-model="taskCtrl.selectFieldType">
                        {{"CREATE_SYNTHETIC_ENTITIES" | translate}}
                        <small ng-show="!taskCtrl.userRole.allowed_creation_of_synthetic_data">(Not Allowed)</small>
                    </label>
                </div>
                <div ng-if="taskCtrl.taskData.task_type == 'LOAD' && !taskCtrl.taskData.version_ind && !taskCtrl.adi_only"
                     class="form-group i-checks col-lg-12">
                    <label>
                        <input ng-disabled="taskCtrl.disableChange"  type="radio" ng-value="'parameters'"
                               name="connectionRadio" ng-model="taskCtrl.selectFieldType"> {{"SELECT_PARAMETERS" |
                        translate}}
                    </label>
                </div>
                <div ng-if="taskCtrl.taskData.task_type == 'LOAD' && !taskCtrl.taskData.version_ind"
                     class="form-group col-lg-12" style="padding-left: 0px; min-height: 160px">
                    <label>{{"EXCLUSION_LIST" | translate}}</label>
                    <textarea ng-pattern="taskCtrl.excultionPattern" rows="5" name="excultionEntitiesList"
                              class="col-lg-12" ng-model="taskCtrl.taskData.entity_exclusion_list">
                    </textarea>
                    <div class="m-t-xs"
                         ng-show="taskCtrl.requestedEntitiesForm.excultionEntitiesList.$invalid && requestedEntitiesForm.submitted">
                        <small ng-if="taskCtrl.requestedEntitiesForm.excultionEntitiesList.$error.pattern"
                               class="text-danger">Please Enter Entity IDs, separated by a comma
                        </small>
                    </div>
                    <div class="m-t-xs"
                         ng-show="taskCtrl.requestedEntities.entities_list && taskCtrl.taskData.entity_exclusion_list == taskCtrl.requestedEntities.entities_list">
                        <small class="text-danger">Entities list is identical to exclusion list. Please fix exclusion
                            list.
                        </small>
                    </div>
                </div>
            </div>

            <div class="form-group col-lg-8"
                 ng-if="taskCtrl.selectFieldType == 'given' && !taskCtrl.taskData.selectAllEntites">
                <textarea ng-disabled="taskCtrl.disableChange" required rows="5" name="entitiesList"
                          class="col-lg-12" ng-change="taskCtrl.entitiesListChange()"
                          ng-model="taskCtrl.requestedEntities.entities_list">
                </textarea>
                <span ng-if="taskCtrl.taskData.task_type == 'LOAD' && !taskCtrl.taskData.version_ind">
                    <span ng-if="taskCtrl.taskData.number_of_entities_to_copy && taskCtrl.requestedEntities.entities_list && requestedEntitiesForm.entitiesList.$invalid == false"
                          style="margin-top: 2px" class="badge pull-right">{{taskCtrl.requestedEntities.entities_list.split(',').length}}/{{taskCtrl.taskData.number_of_entities_to_copy}}
                    </span>
                    <span ng-if="taskCtrl.taskData.number_of_entities_to_copy && requestedEntitiesForm.entitiesList.$error.required == true"
                          style="margin-top: 2px" class="badge pull-right">0/{{taskCtrl.taskData.number_of_entities_to_copy}}
                    </span>
                    <span ng-if="taskCtrl.taskData.number_of_entities_to_copy && requestedEntitiesForm.entitiesList.$error.pattern == true"
                          style="margin-top: 2px" class="badge pull-right">{{requestedEntitiesForm.entitiesList.$viewValue.split(',').length}}/{{taskCtrl.taskData.number_of_entities_to_copy}}
                    </span>
                </span>
                <span ng-if="!(taskCtrl.taskData.task_type == 'LOAD' && !taskCtrl.taskData.version_ind)">
                    <span ng-if="taskCtrl.requestedEntities.entities_list && requestedEntitiesForm.entitiesList.$invalid == false"
                          style="margin-top: 2px" class="badge pull-right">{{taskCtrl.requestedEntities.entities_list.split(',').length}}/{{taskCtrl.maxToCopy}}
                    </span>
                    <span ng-if="requestedEntitiesForm.entitiesList.$error.required == true"
                          style="margin-top: 2px" class="badge pull-right">0/{{taskCtrl.maxToCopy}}
                    </span>
                    <span ng-if="requestedEntitiesForm.entitiesList.$error.pattern == true"
                          style="margin-top: 2px" class="badge pull-right">{{requestedEntitiesForm.entitiesList.$viewValue.split(',').length}}/{{taskCtrl.maxToCopy}}
                    </span>
                </span>

                <div class="m-t-xs">
                    <small class="text-danger">Please Enter Entity IDs, separated by a comma <span style="color: red">*</span>
                    </small>
                </div>
                <div class="m-t-xs"
                     ng-show="taskCtrl.enititesListFailedPatternTest && (taskCtrl.taskData.number_of_entities_to_copy || taskCtrl.maxToCopy)">
                    <small class="text-danger">Number of entities in the entities list does not match number of entities in the General tab.
                        Maximum entities for the task is: {{taskCtrl.taskData.number_of_entities_to_copy ||
                        taskCtrl.maxToCopy}}
                    </small>
                </div>
                <div class="m-t-xs" ng-show="taskCtrl.enititesListNotPassedExclusionList">
                    <small class="text-danger">The following entities {{taskCtrl.existingEntitiesInExclusionListMembers
                        }} are included in the exclusion lists for this environment and business entity. Therefore,
                        those entities cannot be copied into your environment. Please remove them from your list.
                    </small>
                </div>
            </div>
            <div class="form-group col-lg-8" ng-if="taskCtrl.selectFieldType == 'random'">

            </div>
            <div class="form-group col-lg-8" ng-if="taskCtrl.selectFieldType == 'synthetic'">
                <input name="synthetic" ng-disabled="taskCtrl.disableChange" required type="text" class="form-control"
                       ng-model="taskCtrl.requestedEntities.synthetic" ng-pattern="taskCtrl.syntheticPattern">
                <div class="m-t-xs">
                    <small class="text-danger">Please Enter Entity ID for duplication<span style="color: red">*</span>
                    </small>
                </div>
                <div class="m-t-xs"
                     ng-show="taskCtrl.requestedEntitiesForm.synthetic.$invalid && requestedEntitiesForm.submitted">
                    <small ng-if="taskCtrl.requestedEntitiesForm.synthetic.$error.pattern" class="text-danger">Entity ID
                        cannot have comma or spaces<span style="color: red">*</span></small>
                </div>
                <div class="m-t-xs" ng-show="taskCtrl.enititesListNotPassedExclusionList">
                    <small class="text-danger">The following entity is included in the exclusion lists for this environment and business entity. Therefore,
                        this entity cannot be copied into your environment. Please use another entity.
                    </small>
                </div>
            </div>
            <div class="form-group col-lg-8" ng-if="taskCtrl.selectFieldType == 'parameters'">
                <div class="col-lg-12">
                    <div class="checkbox checkbox-primary col-lg-12">
                        <input id="checkbox2" type="checkbox" ng-model="taskCtrl.parametersRandom">
                        <label for="checkbox2">
                            Use Parameters with Random selection
                        </label>
                    </div>
                </div>
                <div class="form-group col-lg-12">
                    <div class="row">
                        <div class="col-lg-12">
                            <a style="font-size: 16px;padding-left: 2px;" ng-click="getEntitesCount()"><i
                                    class="fa fa-refresh"></i></a>
                            <label style="padding-left: 6px;">{{"PARAMETERS_COUNT" | translate}} =
                                <span ng-show="taskCtrl.parametersCount == 'inprogress'">
                                <img src="/img/loading.gif">
                                </span>
                                <span ng-show="taskCtrl.parametersCount !== 'inprogress'">{{taskCtrl.parametersCount}}</span>
                            </label>
                        </div>
                        <div class="col-lg-12" style="padding: 10px;">
                            <query-builder form="requestedEntitiesForm" disablechange="taskCtrl.disableChange"
                                           group="taskCtrl.filter.group" params="taskCtrl.parameters"></query-builder>
                            <div class="m-t-xs" ng-show="taskCtrl.parametersError == true">
                                <small class="text-danger">Please Choose Parameters <span style="color: red">*</span>
                                </small>
                            </div>
                            <p>{{taskCtrl.requestedEntities.query_parameters}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-12"
             ng-if="taskCtrl.taskData.task_type == 'LOAD' && taskCtrl.taskData.version_ind && taskCtrl.step == 2">
            <div class="row">
                <div class="col-lg-3">
                    <label>Select Version for Load</label>
                </div>
                <div class="col-lg-3">
                    <div style="display: inline-flex; vertical-align: top;margin-top: 7px;">
                        From Date:
                    </div>
                    <div class="input-group date" style="display: inline-table;width: calc(100% - 100px)">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        <input type="datetime" class="form-control" ng-model="taskCtrl.versionForLoadFrom"
                               date-time format="DD MMM YYYY" view="date" auto-close="true"
                               min-view="date"
                               ng-blur="taskCtrl.getVersionsForLoad()"/>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div style="display: inline-flex; vertical-align: top;margin-top: 7px;">
                        To Date:
                    </div>
                    <div class="input-group date" style="display: inline-table;width: calc(100% - 100px)">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        <input type="datetime" class="form-control" ng-model="taskCtrl.versionForLoadTo"
                               min-view="date"
                               ng-min="from" date-time format="DD MMM YYYY" view="date" auto-close="true"
                               ng-blur="taskCtrl.getVersionsForLoad()"/>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div ng-init="taskCtrl.getVersionsForLoad()">
                        <a style="font-size: 16px;padding-left: 2px;" ng-show="!taskCtrl.loadingTableVersions"
                           ng-click="taskCtrl.getVersionsForLoad()"><i class="fa fa-refresh"></i></a>
                        <span ng-show="taskCtrl.loadingTableVersions">
                                <img src="/img/loading.gif">
                            </span>
                    </div>
                    <table style="display: table; width: 100%" datatable="" dt-options="taskCtrl.dtOptionsVersions"
                           dt-columns="taskCtrl.dtColumnsVersions" dt-instance="taskCtrl.dtInstanceVersions"
                           class="table table-striped table-bordered table-hover">
                    </table>
                </div>
            </div>
        </div>
    </div>

    <button type="button" class="btn k2-primary-btn" ng-click="taskCtrl.openStep(1,'back')">Back</button>
    <button type="submit" class="btn k2-primary-btn">Next</button>

    <div class="m-t-xs" ng-show="requestedEntitiesForm.$invalid">
        <small ng-if="requestedEntitiesForm.$error.missingParent" class="text-danger">
            Logical units '<' <span ng-repeat="missingParent in LUsMissingParent">{{missingParent}}</span>'>' are missing their parent logical units. Please change the selection method to
            “Entities List” or “Random Selection” or add the missing parent logical units to the tasks.
        </small>
    </div>
</fieldset>